# This file is a template, and might need editing before it works on your project.
# To contribute improvements to CI/CD templates, please follow the Development guide at:
# https://docs.gitlab.com/ee/development/cicd/templates.html
# This specific template is located at:
# https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/LaTeX.gitlab-ci.yml

---
variables:
  # Feel free to choose the image that suits you best.
  # blang/latex:latest ... Former image used in this template. No longer maintained by author.
  # listx/texlive:2020 ... The default, referring to TexLive 2020. Current at least to 2021-02-02.

  # Additional alternatives with high Docker pull counts:
  # thomasweise/docker-texlive-full
  # thomasweise/texlive
  # adnrv/texlive
  LATEX_IMAGE: listx/texlive:2020

build:
  image: $LATEX_IMAGE
  script:
    - latexmk -pdf main.tex

  artifacts:
    paths:
      - "main.pdf"

deploy:
  script:
    - ls
    - git rm -rf "*.tex" "*.cls" "*.yml"
    - git status
    - git add *
    - git branch tmp
    - git config user.email "ci_pipeline@gitlab.com"
    - git config user.name "ci_pipeline"
    - git remote add gitlab_origin https://oauth2:$GITLAB_ACCESS_TOKEN@gitlab.com/KaranJayachandra/cv.git
    - git pull gitlab_origin gl-pages
    - git checkout gl-pages
    - git merge tmp
    - git status
    - git commit -m "Push latest PDF from Pipeline"
    - git push gitlab_origin HEAD:gl-pages -o ci.skip # prevent triggering pipeline again
  needs: ["build"]
  dependencies:
    - build